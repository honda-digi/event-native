<!doctype html><html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>投稿</title>
<style>
:root{--bg:#0b0c10;--card:#151821;--text:#e9eef7;--muted:#9aa4b2;--line:#262b36;}
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;background:var(--bg);color:var(--text);}
.wrap{max-width:860px;margin:0 auto;padding:20px;display:flex;flex-direction:column;gap:14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
.label{font-size:12px;color:var(--muted);letter-spacing:.02em}
textarea{width:100%;min-height:160px;resize:vertical;border-radius:12px;border:1px solid var(--line);padding:12px;background:#0f121a;color:var(--text);font-size:15px;line-height:1.7}
.row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.hint{font-size:12px;color:var(--muted)}
button{border:1px solid var(--line);background:#1d2330;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
button:hover{filter:brightness(1.08)}
</style></head><body>
<div class="wrap">
  <section class="card">
    <div class="label">投稿フォーム</div>
    <form id="postForm">
      <textarea id="message" placeholder="Enterで投稿 / Shift+Enterで改行"></textarea>
      <div class="row">
        <div class="hint">room: <span id="roomView"></span></div>
        <button type="submit">投稿</button>
      </div>
    </form>
  </section>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
const SUPABASE_URL="https://alrafntzbegnulyucwtk.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFscmFmbnR6YmVnbnVseXVjd3RrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNDcxNTcsImV4cCI6MjA4MTcyMzE1N30.rJbZe24fGME1xAXAs9W4fCjutZXMHT550UETW5MRyAQ";
const supabase=createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

const qs=new URLSearchParams(location.search);
const room=(qs.get("room")||"demo").slice(0,60);
document.getElementById("roomView").textContent=room;

const form=document.getElementById("postForm");
const ta=document.getElementById("message");

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const body=ta.value.trim();
  if(!body) return;
  const { error }=await supabase.from("posts").insert({ room, body });
if (error) {
  console.error(error);
  alert(`送信失敗: ${error.message}\n(code: ${error.code ?? ""})`);
  return;
}
  ta.value=""; ta.focus();
});

ta.addEventListener("keydown",(e)=>{
  if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); form.requestSubmit(); }
});
</script></body></html>
